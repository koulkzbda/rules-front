<form class="row">
  <div class="col-12 col-sm-5">
    <mat-form-field appearance="outline">
      <mat-label>Compliance rules name</mat-label>
      <input matInput [(ngModel)]="compliance.label" name="label">
    </mat-form-field>
  </div>
  <div class="col-12">
    <h2 class="mat-text-primary text-center">Set compliance rules</h2>
  </div>
  <div class="col-12">
    <div class="overflow-auto w-100 table-wrapper">
      <table mat-table [dataSource]="dataSource" cdkDropList [cdkDropListData]="compliance.complianceRules"
        (cdkDropListDropped)="drop($event)" class="w-100 border table-striped">

        <ng-container matColumnDef="drag">
          <th mat-header-cell *matHeaderCellDef class="text-center text-white font-weight-normal font-size-5 pr-3">
            Order
          </th>
          <td mat-cell *matCellDef="let rule; let i = index" class="text-center border">
            <p cdkDragHandle class="mr-3 min-width-xs pt-2">{{i}}</p>
          </td>
        </ng-container>

        <ng-container matColumnDef="group">
          <th mat-header-cell *matHeaderCellDef class="text-center text-white font-weight-normal font-size-5"> Group
          </th>
          <td mat-cell *matCellDef="let rule; let i = index" class="text-center border">
            <mat-form-field appearance="legacy" class="mat-form-field-padding-top max-width-l">
              <mat-select [(value)]="compliance.complianceRules[i].group" [compareWith]="compareByGroupLabel">
                <mat-option *ngFor="let group of groups" [value]="group">
                  {{group.label}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </td>
        </ng-container>

        <ng-container matColumnDef="complianceRule">
          <th mat-header-cell *matHeaderCellDef class="text-center text-white font-weight-normal font-size-5"> Rule
          </th>
          <td mat-cell *matCellDef="let rule; let i = index" class="text-center border">
            <mat-form-field appearance="legacy" class="mat-form-field-padding-top">
              <mat-select [(value)]="compliance.complianceRules[i].rule" [compareWith]="compareByWatchlistLabel">
                <mat-option *ngFor="let watchlist of compliance.complianceRules[i].group.watchlists"
                  [value]="watchlist">
                  {{watchlist.label}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </td>
        </ng-container>

        <ng-container matColumnDef="aggregation">
          <th mat-header-cell *matHeaderCellDef class="text-center text-white font-weight-normal font-size-5"> Aggregate
            by
          </th>
          <td mat-cell *matCellDef="let rule; let i = index" class="text-center border">
            <mat-form-field appearance="legacy" class="mat-form-field-padding-top">
              <mat-select [(value)]="compliance.complianceRules[i].aggregation" [compareWith]="compareByFieldLabel">
                <mat-option *ngFor="let fieldType of fieldTypes" [value]="fieldType">
                  {{fieldType.label}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </td>
        </ng-container>

        <ng-container matColumnDef="condition">
          <th mat-header-cell *matHeaderCellDef class="text-center text-white font-weight-normal font-size-5"> Condition
          </th>
          <td mat-cell *matCellDef="let rule; let i = index" class="text-center border">
            <mat-form-field appearance="legacy" class="mat-form-field-padding-top max-width-sm">
              <mat-select [(value)]="compliance.complianceRules[i].condition">
                <mat-option *ngFor="let condition of fieldTypes[0].conditions" [value]="condition">
                  {{condition}}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </td>
        </ng-container>

        <ng-container matColumnDef="warning">
          <th mat-header-cell *matHeaderCellDef class="text-center text-white font-weight-normal font-size-5"> Warning
          </th>
          <td mat-cell *matCellDef="let rule; let i = index" class="text-center border">
            <mat-form-field appearance="legacy" class="mat-form-field-padding-top max-width-sm">
              <input matInput maxlength="3" [(ngModel)]="compliance.complianceRules[i].warning" name="warning-{{i}}">
            </mat-form-field>
          </td>
        </ng-container>

        <ng-container matColumnDef="breach">
          <th mat-header-cell *matHeaderCellDef class="text-center text-white font-weight-normal font-size-5"> Breach
          </th>
          <td mat-cell *matCellDef="let rule; let i = index" class="text-center border">
            <mat-form-field appearance="legacy" class="mat-form-field-padding-top max-width-sm">
              <input matInput maxlength="3" [(ngModel)]="compliance.complianceRules[i].breach" name="breach-{{i}}">
            </mat-form-field>
          </td>
        </ng-container>

        <ng-container matColumnDef="regulationThreshold">
          <th mat-header-cell *matHeaderCellDef class="text-center text-white font-weight-normal font-size-5">
            Threshold
          </th>
          <td mat-cell *matCellDef="let rule; let i = index" class="text-center border min-width-md">
            <p class="pt-2">{{compliance.complianceRules[i].regulationThreshold}}</p>
          </td>
        </ng-container>

        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef class="text-center text-white font-weight-normal font-size-5 pl-3">
            Actions
          </th>
          <td mat-cell *matCellDef="let rule; let i = index" class="text-center border">
            <button (click)="deleteRule(i)" mat-icon-button>
              <mat-icon class="pl-3">delete</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true" class="mat-color-primary border"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;" cdkDragLockAxis="y" cdkDrag [cdkDragData]="row">
        </tr>
      </table>
    </div>
  </div>
  <div class="col-12 mt-3">
    <button (click)="addNewRule()" mat-button color="primary">CREATE A NEW RULE</button>
  </div>
  <div class="col-12 d-flex justify-content-around my-3">
    <button (click)="saveOrOpenDialog()" mat-raised-button color="primary">SAVE</button>
  </div>
